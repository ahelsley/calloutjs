var global=window,maxDeferredDOMInsertions=20;HTMLElement.prototype.instantiate=function(a,b,d){a=instantiateTemplate(a,b,d,this);invokeLoadHandlers(a);return a};function TemplateInstances(a,b,d,c){return c.instantiate(a,b,d)}window.TemplateInstances=TemplateInstances;
function instantiateTemplate(a,b,d,c,e){var f=[];a=a?resolve(a):a;if(!a)return f;var g=a.getAttribute("foreach");if("#"===g.charAt(0)){debugger;g=g.substring(1)}d=d||[new Frame(null,global)];c=c?resolve(c):a.parentForInstances||a.parentNode;void 0===b&&(b=getCollectionForTemplate(a,d));if(void 0===b)return f;Array.isArray(b)||(b=Array(b));void 0===b.views&&(b.views=[]);b.views.push$(c);c&&(void 0===c.collections&&(c.collections=[]),c.collections.push$(b.represents||b));c&&void 0===c.model&&(c.model=
b);for(var k=0,l=0;l<b.length;l++){var h=b[l];g&&(d[0].explicit[g]=h);if("object"!==typeof h){switch(typeof h){case "string":b[l]=new String(h);break;case "number":b[l]=new Number(h);break;case "boolean":b[l]=new Boolean(h)}h=b[l]}h=instantiateTemplateOnce(a,h,d,b,l);g&&delete d[0].explicit[g];h&&(f.push(h),c&&0<maxDeferredDOMInsertions&&f.length-k>maxDeferredDOMInsertions&&(k+=appendInstances(f.slice(k),c,!e)))}c&&appendInstances(f.slice(k),c,!e);return f}window.instantiateTemplate=instantiateTemplate;
function instantiateTemplateOnce(a,b,d,c,e){var f=a.cloneNode(!0);f.template=a;a.instances||(a.instances=[]);a.instances.push(f);f.model=b;"object"===typeof b&&(b.views&&b.views.push||(b.views=[]),b.views.push$(f));onModelChange.bind&&(f.onModelChange=onModelChange.bind(f));f.collection=c;f.n=e;d=d||newEmptyContext();d.unshift(new Frame({explicit:d[0].explicit,model:b,template:a,instance:f,collection:c,n:e}));a=substituteChildren.apply(f,[d,f]);if(invokeHandler(f,"pre")){f.subinstances=f.subinstances||
[];b=f.subinstances;for(c=0;c<a.length;c++){e=a[c];var g=getCollectionForTemplate(e,d);g&&(e=instantiateTemplate(e.restartAtTemplate||e,g,d,e.parentNode),b.concat(e))}invokeHandler(f,"post")||(f=void 0)}else f=void 0;d.shift();return f}window.instantiateTemplateOnce=instantiateTemplateOnce;
function revealInstance(a){a.removeAttribute("foreach");a.removeAttribute("in");a.removeAttribute("of");a.removeAttribute("reapply");a.removeAttribute("to");a.className=a.className.replace(/\btemplate\b/g," ").trim()}window.revealInstance=revealInstance;function appendInstances(a,b,d){Array.isArray(a)||(a=[a]);for(var c=0,e=0;e<a.length;e++)a[e].parentNode||(d&&revealInstance(a[e]),b.appendChild(a[e]),c++);return c}window.appendInstances=appendInstances;
function onModelChange(){this.model&&Array.isArray(this.model.views)&&this.model.views.removeAll(this);var a=instantiateTemplateOnce(this.template,this.model,this.context||newEmptyContext(),this.collection,this.n);this.parentNode&&this.parentNode.replaceChild(a,this)}window.onModelChange=onModelChange;function sendModelChange(a){if(Array.isArray(a.views))for(var b=0;b<a.views.length;b++){var d=a.views[b];if(d.onModelChange)d.onModelChange()}}window.sendModelChange=sendModelChange;
var connectors=["",", ",", "," and ",""];function invokeHandler(a,b){if(a[b]&&"function"===typeof a[b])return a[b].call(a);bindHandler(a,b);return a[b]?a[b].call(a):!0}function bindHandler(a,b){var d=a.template;if(d.hasAttribute(b)){var c=d.getAttribute(b);d.removeAttribute(b);try{d[b]=new Function("nullEvent",c),console.log("installed handler '"+b+"': "+c)}catch(e){console.log("exception while installing handler '"+b+"': "+c+"\n\nException: "+e)}}!a[b]&&d[b]&&(a[b]=d[b].bind(a))}
function invokeLoadHandlers(a){for(var b=0;b<a.length;b++){var d=a[b];d.isLoaded||(invokeHandler(d,"load"),d.isLoaded=!0);d.subinstances&&0<d.subinstances.length&&invokeLoadHandlers(d.subinstances,"load")}}
function getCollectionForTemplate(a,b,d){var c=!1,e=!1,f=!1,g=a.getAttribute(d||"in")||a.getAttribute("of")||a.getAttribute("foreach");d=[];a.hasAttribute("reapply")&&(b=b.slice(0,1));if("string"===typeof g){for(;"*"===g.charAt(0)||"^"===g.charAt(0)||"$"===g.charAt(0);)"*"===g.charAt(0)?c=!0:"^"===g.charAt(0)?e=c=!0:"$"===g.charAt(0)&&(f=!0),g=g.substring(1);d=""===g&&Array.isArray(b.model)?b.model:resolveValueOfTemplateVariableCached(g,b)}else"object"===typeof g?d=g:void 0!==typeof g&&(d=[g]);if(d&&
d.debug)debugger;if(c&&!Array.isArray(d)){a=Object.keys(d)||[];f&&a.sort();b=[];b.sorted_p=f;for(f=0;f<a.length;f++)e?b.push({name:a[f],value:d[a[f]]}):b.push(d[a[f]]);b.represents=d;d=b}else f&&d.sort();return d}
function substituteChildren(a,b){for(var d=[],c=void 0,e=void 0,f=0;f<this.attributes.length;f++){var g=this.attributes[f];g.value=substituteInText(g.value,a);"id"===g.name?c=g:"genid"===g.name&&(e=g);if("#"===g.name.charAt(0)){debugger;this.removeAttribute(g.name)}else if(":"===g.name.charAt(0)){var k=g.name.substring(1);this.setAttribute(k,g.value);this.removeAttribute(g.name)}}c&&this.removeAttribute(c.name);e&&(this.setAttribute("id",e.value),this.removeAttribute(e.name));for(f=0;f<this.childNodes.length;f++)switch(c=
this.childNodes[f],c.nodeType){case Node.TEXT_NODE:c.data=substituteInText(c.data,a);break;case Node.ELEMENT_NODE:if(c.hasAttribute("foreach"))d.push(c),c.hasAttribute("id")&&(e=substituteInText(c.getAttribute("id"),a),c.setAttribute("id",e));else if(c.hasAttribute("reapply")){if(!c.restartAtTemplate){e=c.getAttribute("reapply");g=a[0].template;if(""!==e&&"."!==e)for(f=0;f<a.length;f++)if(k=a[f].template,k.getAttribute("foreach")===e){g=k;break}c.restartAtTemplate=g;c.setAttribute("foreach",e);c.setAttribute("in",
c.getAttribute("to"))}d.push(c)}else e=substituteChildren.apply(c,arguments),d=d.concat(e),c.instance=b;break;case Node.ATTRIBUTE_NODE:break;case Node.ENTITY_NODE:break;case Node.ENTITY_REFERENCE_NODE:break;default:this.removeChild(c)}return d}
var referenceRE=/@{([\[\]\/<>()*.:a-zA-Z0-9_,@#$]+?)}/g,erosionControlRE="[\\[\\]<>()*]*",parseReferenceRE=RegExp("^("+erosionControlRE+")((\\/?)(\\.*?))+(((?:[a-zA-Z0-9_][:a-zA-Z0-9_]*)(?:.[a-zA-Z0-9_][:a-zA-Z0-9_]*)*)?(?:\\.?([=,@#$]))?)("+erosionControlRE+")$");function substituteInText(a,b){for(var d=[],c=0,e;e=referenceRE.exec(a);){var f=e.index,g=e.index+e[0].length;e=resolveValueOfTemplateVariableCached(e[1],b);d.push(a.substring(c,f));d.push(e);c=g}return d.join("")+a.substring(c)}
function resolveValueOfTemplateVariableCached(a,b){void 0===b[0].cache[a]&&(b[0].cache[a]=resolveValueOfTemplateVariable(a,b));return b[0].cache[a]}function resolveValueOfTemplateVariable(a,b){var d=b.length-1,c=a.search(/[^.]/);0>c&&(c=0);a=a.substring(c);0<c&&c--;"/"===a.charAt(0)&&(c=d,a=a.substring(1));for(var d=a.split("."),e=c;e<b.length;e++)if(c=b[e].lookup(d[0]),void 0!==c){for(e=1;e<d.length;e++)if(c=c[d[e]],e<d.length-1&&(void 0===c||null===c))return;return c}}
function newContext(a){return[a]}function newEmptyContext(){return[new Frame(null,{})]}
function Frame(a,b){if(void 0!==a&&"object"===typeof a)for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d]);this.cache={};this.explicit=this.explicit||{};this.model=this.model||b;this.lookup=function(a){if(void 0!==a){if(1===a.length)switch(a){case "@":return 1+this.n;case "$":return conditionalPluralSuffix(this.collection.length);case "#":return this.collection?this.collection.length:void 0;case ",":return this.collection&&this.n<this.collection.length?",":""}else if("length"===a||"size"===a||"#"===
a)return this.collection.length;return this.cache[a]||(this.cache[a]=this.model[a])||(this.cache[a]=this.explicit[a])}}}window.Frame=Frame;function resolve(a){return"string"!==typeof a?a:global[a]?global[a]:document.getElementById(a)}Object.defineProperty(Number.prototype,"$",{get:function(){return conditionalPluralSuffix(this.valueOf())}});Object.defineProperty(Array.prototype,"$",{get:function(){return conditionalPluralSuffix(this.length)}});Object.defineProperty(Array.prototype,"#",{get:function(){return this.length}});
Object.defineProperty(Array.prototype,"size",{get:function(){return this.length}});Array.prototype.removeAll=function(a){for(var b=this.indexOf(a);0<=b;b=this.indexOf(a))this.splice(b,1)};Array.prototype.push$=function(a){0>this.indexOf(a)&&this.push(a)};function conditionalPluralSuffix(a){return void 0!==a&&1!=a?"s":""}function pluralFormOf(a){return a+"s"};
